# Dockerとは

Dockerは、コンテナ仮想化を用いてアプリケーションを実行するためのOSSである。ここでは、Dockerを利用する上で理解しておきたい概念をざっくりと学ぶ。


## 仮想化とは

仮想化とは、メモリやCPU、ハードディスクといったコンピュータの限られたリソースを抽象化すること、及びその技術のことである。仮想化をすることで、１台の物理サーバー上で複数のOSを稼働させたり、逆に複数の物理サーバーを統合して１台のサーバーとして扱うこともできる。例えば、Windows上でLinux系のOSを実行するための仮想環境を構築するOSSとして[Oracle VM Virtual Box](https://www.virtualbox.org/)などが挙げられる。

## ハイパーバイザーとコンテナ
Dockerは「コンテナ型仮想化」と呼ばれる仮想化技術を採用している。前節で例に挙げたVirtual Boxは「ハイパーバイザー型仮想化」を用いている。例えば、Windows上でLinux系のOSの仮想環境を3つ動かしたいとしよう。ハイパーバイザー型仮想化では、ホストOS（Windows）上にゲストOS(Linux系OS)を3つインストールし、それぞれにリソースを割り振る。

コンテナ型仮想化の説明をするために、ハイパーバイザー型仮想化が比較対象として挙げられることが多い。このような画像を目にしたことがあるかもしれない。

![wid_1](img/wid1.webp)
出典: [docker.com "What is a Container?"](https://www.docker.com/resources/what-container/)

上の図は、コンテナ型（左）とハイパーバイザー型（右）それぞれの仮想化の仕組みを表している。コンテナ型仮想化では、コンテナ内のOSはホストOSを共有する。つまり、左図では6つのコンテナが起動しているが、ハイパーバイザー型と異なり、6つもOSをインストールする必要がなく、その分軽量である。一方で、ホストOSに依存する部分が大きく、利用できるOSは限られる。仮想化技術ごとに特徴があり、一長一短である。目的に応じて、適した仮想化技術を用いるのがいいだろう。


### なぜWindowsでLinux系コンテナが動作するのか
この節は興味がなければ、読み飛ばして構わない。前節で、コンテナ型仮想化はホストOSに大きく依存すると述べた。DockerのコンテナではLinux系のOSが動作している。ホストOSがWindowsだろうがMacOSだろうがコンテナで動くのはLinux系のOSである。これはコンテナ型仮想化の仕組みに矛盾している。なぜWindowsでLinux系コンテナが動作するのだろうか。

答えは単純なもので「ハイパーバイザー型仮想化でホストOS上にLinux系のOSの仮想環境を建て、その中でDockerを動かしている」だけである。コンテナ型inハイパーバイザー型という訳だ。Linux系のOSにも様々な種類があるが、Linuxカーネル自体には互換性があり、OSに依存しない。


## Dockerの何が良いのか
ここまで、仮想化の概念からDockerが採用するコンテナ型仮想化の仕組みまでを紹介してきた。では、なぜDockerを使うべきなのだろうか。Dockerはどのような時に有用なのだろうか。いくつかの事例を挙げる。

### プロジェクトに応じて環境を分けたい
Pythonで開発を行う中で、あるプロジェクトではPython 3.7を利用しなければいけないが、他のプロジェクトでは、Python 3.10を利用したいということがあるかもしれない。このような単純な内容ならPythonのバージョン管理パッケージpyenvなどを利用すれば良いかもしれない。だが、さらに複数のパッケージのバージョンも決まっており、加えてC++やJavaも使う必要がありそのバージョンも指定されるとしたらどうだろうか。Dockerを用いると、プロジェクトごとにコンテナを建て、コンテナごとに、必要なバージョンを指定すれば良い。コンテナ内で全てが完結するため、自分のローカルの環境を汚さないで済むのも嬉しい。

### チーム開発で開発環境を統一したい
複数人で集まってチーム開発をすることを考える。ある人はWindowsのノートPCを使っており、またある人はMac Bookを使っている。Windowsで書いたコードがMacでは動かないというのは避けたい。また、使用するパッケージのバージョンはチームで統一したい。Dockerでは、自分が作ったコンテナの設計図（コンテナイメージ）の配布が容易である。チームリーダーがあらかじめ適したコンテナイメージを作成し、チームメンバーに配布するだけで全ての懸念が解決するのだ。自宅のPCはMacだが外ではWindowsを使うなどの場合にも同じことが言える。

### 試験的な環境を作りたい
Dockerの利点としてスクラップ・ビルドが容易であることが挙げられる。ローカルの環境を汚さずにコンテナを建てて、捨ててを繰り返すことが可能である。コンテナ内であれば、**おそらく**`rm - rf /`してもローカル環境に被害が及ぶことはないだろう[^dash]。筆者は責任を取れないので、試す際は自己責任で行って欲しい。本筋から逸れたが、パッケージ間で競合が起こるかを試したり、一時的な環境を作ったりといった、「使い捨てるための環境」を作る際にもDockerは有用である。

[^dash]: [Qiita "rm -rf /"をやってみた](https://qiita.com/iLP_isse/items/95b149c607f5f06183af)